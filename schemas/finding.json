{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "SecFlow Finding Schema",
  "description": "Canonical data contract for SecFlow findings normalization and enrichment",
  "type": "object",
  "required": [
    "finding_schema_version",
    "id",
    "project_id",
    "detector_id",
    "title",
    "severity",
    "resource",
    "created_at"
  ],
  "properties": {
    "finding_schema_version": {
      "type": "string",
      "pattern": "^\\d+\\.\\d+\\.\\d+$",
      "description": "Semantic version of the finding schema",
      "example": "1.0.0"
    },
    "id": {
      "type": "string",
      "format": "uuid",
      "description": "Unique identifier for the finding"
    },
    "project_id": {
      "type": "string",
      "format": "uuid",
      "description": "Project this finding belongs to"
    },
    "run_id": {
      "type": "string",
      "format": "uuid",
      "description": "Optional run identifier"
    },
    "detector_id": {
      "type": "string",
      "pattern": "^[A-Za-z0-9_.-]+$",
      "description": "Canonical tool or plugin id, e.g. scan.nuclei"
    },
    "title": {
      "type": "string",
      "minLength": 1,
      "description": "Human-readable finding title"
    },
    "severity": {
      "type": "string",
      "enum": ["info", "low", "medium", "high", "critical"],
      "description": "Normalized severity level"
    },
    "resource": {
      "type": "string",
      "description": "Canonical URL or identifier of the affected resource"
    },
    "evidence": {
      "type": "object",
      "description": "Structured evidence data",
      "additionalProperties": true
    },
    "cwe": {
      "type": "integer",
      "minimum": 1,
      "description": "Common Weakness Enumeration ID"
    },
    "owasp": {
      "type": "string",
      "pattern": "^A\\d{2}$",
      "description": "OWASP Top 10 category"
    },
    "cve_ids": {
      "type": "array",
      "items": {
        "type": "string",
        "pattern": "^CVE-\\d{4}-\\d{4,}$"
      },
      "description": "List of associated CVE identifiers"
    },
    "cvss": {
      "type": "number",
      "minimum": 0.0,
      "maximum": 10.0,
      "description": "CVSS score"
    },
    "mitre_attack": {
      "type": "array",
      "items": {
        "type": "string",
        "pattern": "^T\\d{4}$"
      },
      "description": "MITRE ATT&CK technique IDs"
    },
    "poc_links": {
      "type": "array",
      "items": {
        "type": "string",
        "format": "uri"
      },
      "description": "Proof of concept links"
    },
    "created_at": {
      "type": "string",
      "format": "date-time",
      "pattern": ".*Z$",
      "description": "UTC timestamp with Z suffix"
    },
    "provenance": {
      "type": "object",
      "description": "Tool and execution metadata",
      "additionalProperties": true
    }
  },
  "additionalProperties": false
}
