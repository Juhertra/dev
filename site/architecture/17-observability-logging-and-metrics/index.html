<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>Observability - SecFlow Docs</title>
        <link href="../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../css/fontawesome.min.css" rel="stylesheet">
        <link href="../../css/brands.min.css" rel="stylesheet">
        <link href="../../css/solid.min.css" rel="stylesheet">
        <link href="../../css/v4-font-face.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link id="hljs-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" >
        <link id="hljs-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" disabled>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../..">SecFlow Docs</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar-collapse" aria-controls="navbar-collapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="nav-item">
                                <a href="../../developer-start-here/" class="nav-link">Developer Start Here</a>
                            </li>
                            <li class="nav-item">
                                <a href="../../shared-state/" class="nav-link">Shared-State Guide</a>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Governance</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../governance/engineering-standards/" class="dropdown-item">Engineering Standards</a>
</li>
                                    
<li>
    <a href="../../governance/development-conventions/" class="dropdown-item">Development Conventions</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">API Documentation</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../api/" class="dropdown-item">Overview</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item">
                                <a href="../../security/" class="nav-link">Security</a>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Overview</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../00-index/" class="dropdown-item">Home</a>
</li>
                                    
<li>
    <a href="../01-title-and-executive-summary/" class="dropdown-item">Executive Summary</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle active" aria-current="page" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Architecture</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../02-architecture-philosophy/" class="dropdown-item">Philosophy</a>
</li>
                                    
<li>
    <a href="../03-repository-layout/" class="dropdown-item">Repository Layout</a>
</li>
                                    
<li>
    <a href="../04-core-packages-and-responsibilities/" class="dropdown-item">Core Packages</a>
</li>
                                    
<li>
    <a href="../05-orchestration-and-workflow-engine/" class="dropdown-item">Orchestration Engine</a>
</li>
                                    
<li>
    <a href="../06-plugin-system/" class="dropdown-item">Plugin System</a>
</li>
                                    
<li>
    <a href="../07-tools-integration-model/" class="dropdown-item">Tools Integration</a>
</li>
                                    
<li>
    <a href="../08-tool-manager-and-ux-design/" class="dropdown-item">Tool Manager & UX</a>
</li>
                                    
<li>
    <a href="../09-resource-registry/" class="dropdown-item">Resource Registry</a>
</li>
                                    
<li>
    <a href="../10-wordlist-and-output-sharing/" class="dropdown-item">Wordlists & Sharing</a>
</li>
                                    
<li>
    <a href="../11-project-isolation-and-data-sharing/" class="dropdown-item">Project Isolation & Sharing</a>
</li>
                                    
<li>
    <a href="../12-findings-model-and-schema/" class="dropdown-item">Findings Schema</a>
</li>
                                    
<li>
    <a href="../13-cve-cwe-poc-enrichment-layer/" class="dropdown-item">Enrichment Layer</a>
</li>
                                    
<li>
    <a href="../14-poc-sources-and-legal-guidelines/" class="dropdown-item">PoC Sources & Legal</a>
</li>
                                    
<li>
    <a href="../15-garbage-collection-and-retention/" class="dropdown-item">Garbage Collection</a>
</li>
                                    
<li>
    <a href="../16-security-model/" class="dropdown-item">Security Model</a>
</li>
                                    
<li>
    <a href="./" class="dropdown-item active" aria-current="page">Observability</a>
</li>
                                    
<li>
    <a href="../18-error-handling-and-recovery/" class="dropdown-item">Error Handling</a>
</li>
                                    
<li>
    <a href="../19-risk-assessment-framework/" class="dropdown-item">Risk Assessment</a>
</li>
                                    
<li>
    <a href="../20-migration-and-implementation-phases/" class="dropdown-item">Migration Plan</a>
</li>
                                    
<li>
    <a href="../21-ci-cd-and-testing-strategy/" class="dropdown-item">CI/CD & Testing</a>
</li>
                                    
<li>
    <a href="../22-developer-experience-and-docs/" class="dropdown-item">Dev Experience & Docs</a>
</li>
                                    
<li>
    <a href="../23-future-roadmap/" class="dropdown-item">Future Roadmap</a>
</li>
                                    
<li>
    <a href="../24-final-consensus-summary/" class="dropdown-item">Final Consensus</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Review & Validation</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../review/REVIEW_GUIDELINES/" class="dropdown-item">Guidelines</a>
</li>
                                    
<li>
    <a href="../../review/review_workflow/" class="dropdown-item">Workflow</a>
</li>
                                    
<li>
    <a href="../../review/review_assignments/" class="dropdown-item">Assignments</a>
</li>
                                    
<li>
    <a href="../../review/validation_checklist/" class="dropdown-item">Checklist</a>
</li>
                                    
<li>
    <a href="../../review/REVIEW_STATUS/" class="dropdown-item">Status</a>
</li>
                                    
<li>
    <a href="../../review/validation_report/" class="dropdown-item">Report</a>
</li>
                                    
<li>
    <a href="../../review/VALIDATION_SUMMARY/" class="dropdown-item">AI Summary</a>
</li>
                                    
<li>
    <a href="../../review/mermaid-smoketest/" class="dropdown-item">Mermaid Smoketest</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ms-md-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-toggle="modal" data-bs-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../16-security-model/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../18-error-handling-and-recovery/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-bs-toggle="collapse" data-bs-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-body-tertiary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-bs-level="1"><a href="#17-observability-logging-metrics-tracing" class="nav-link">17 — Observability, Logging, Metrics &amp; Tracing</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-bs-level="2"><a href="#overview" class="nav-link">🧭 Overview</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#observability-architecture-overview-m1" class="nav-link">🧱 Observability Architecture Overview (M1)</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#logging-subsystem-m1" class="nav-link">🧩 Logging Subsystem (M1)</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#metrics-subsystem-m1" class="nav-link">📊 Metrics Subsystem (M1)</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#debugging-troubleshooting-m1" class="nav-link">🔍 Debugging &amp; Troubleshooting (M1)</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#performance-monitoring-m1" class="nav-link">📈 Performance Monitoring (M1)</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#future-enhancements-m5" class="nav-link">🔮 Future Enhancements (M5+)</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#observability-best-practices" class="nav-link">📚 Observability Best Practices</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#metrics-system" class="nav-link">📊 Metrics System</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#example-grafana-dashboard-panels" class="nav-link">🔍 Example Grafana Dashboard Panels</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#error-correlation-incident-debugging" class="nav-link">🧩 Error Correlation &amp; Incident Debugging</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#alerting-health-checks" class="nav-link">🧠 Alerting &amp; Health Checks</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#security-of-observability-data" class="nav-link">🔒 Security of Observability Data</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#correlation-example-end-to-end-trace" class="nav-link">🧱 Correlation Example: End-to-End Trace</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#integration-with-cicd-and-testing" class="nav-link">🧩 Integration with CI/CD and Testing</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#future-enhancements" class="nav-link">🔮 Future Enhancements</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="17-observability-logging-metrics-tracing">17 — Observability, Logging, Metrics &amp; Tracing<a class="headerlink" href="#17-observability-logging-metrics-tracing" title="Permanent link">&para;</a></h1>
<h2 id="overview">🧭 Overview<a class="headerlink" href="#overview" title="Permanent link">&para;</a></h2>
<p>The <strong>Observability Layer</strong> provides full transparency into the runtime behavior of SecFlow.<br />
It enables developers, analysts, and operators to:
- Track system health and performance metrics.<br />
- Trace workflow execution across tools and workers.<br />
- Monitor logs and alerts from all layers (API, Worker, Sandbox).<br />
- Correlate findings, runs, and audit trails with unique identifiers.</p>
<p><strong>M1 Implementation Status</strong>: ✅ <strong>Complete</strong> - In-memory metrics collection, structured logging, and audit trails delivered.</p>
<p><strong>Note</strong>: In M1, metrics are collected in-memory and shown in logs; a future release will expose them in Prometheus format.</p>
<p>The observability system is <strong>standards-based</strong>, built upon:
- <strong>Structured Logging</strong> for event correlation (M1)
- <strong>In-Memory Metrics</strong> for performance monitoring (M1)
- <strong>Audit Trails</strong> for security and compliance (M1)
- <strong>Prometheus</strong> for metrics export (M5 planned)
- <strong>OpenTelemetry</strong> for tracing and context propagation (M5 planned)</p>
<hr />
<h2 id="observability-architecture-overview-m1">🧱 Observability Architecture Overview (M1)<a class="headerlink" href="#observability-architecture-overview-m1" title="Permanent link">&para;</a></h2>
<div class="mermaid">%%{init: {"theme":"neutral"}}%%
flowchart TD
    A["Workflow Executor"]
    B["Plugin Loader"]
    C["StoragePort"]
    D["Security Framework"]

    A --&gt; E["Structured Logging"]
    B --&gt; E
    C --&gt; E
    D --&gt; E

    A --&gt; F["In-Memory Metrics"]
    B --&gt; F
    C --&gt; F
    D --&gt; F

    D --&gt; G["Audit Logging"]

    E --&gt; H["Log Files"]
    F --&gt; I["Metrics Storage"]
    G --&gt; J["Security Events"]

    K["M5: Prometheus Export"]
    L["M5: OpenTelemetry"]

    F -.-&gt; K
    E -.-&gt; L</div>
<p><strong>M1 Components Delivered</strong>:
- ✅ <strong>Structured Logging</strong>: JSON format with correlation IDs
- ✅ <strong>In-Memory Metrics</strong>: Performance and execution metrics
- ✅ <strong>Audit Logging</strong>: Security events and compliance trails
- ✅ <strong>Event Correlation</strong>: Trace IDs for workflow execution
- ✅ <strong>StoragePort Integration</strong>: Metrics persistence via StoragePort</p>
<hr />
<h2 id="logging-subsystem-m1">🧩 Logging Subsystem (M1)<a class="headerlink" href="#logging-subsystem-m1" title="Permanent link">&para;</a></h2>
<h3 id="logging-design-goals">Logging Design Goals<a class="headerlink" href="#logging-design-goals" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Goal</th>
<th>M1 Implementation</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Machine-readable</strong></td>
<td>JSON structured format with standard fields</td>
</tr>
<tr>
<td><strong>Correlated across systems</strong></td>
<td><code>trace_id</code> and <code>span_id</code> included</td>
</tr>
<tr>
<td><strong>Searchable</strong></td>
<td>Standardized field names and values</td>
</tr>
<tr>
<td><strong>Audit-compliant</strong></td>
<td>Immutable logs with timestamps</td>
</tr>
<tr>
<td><strong>Performance-aware</strong></td>
<td>Async logging to avoid blocking</td>
</tr>
</tbody>
</table>
<h3 id="structured-log-format-m1">Structured Log Format (M1)<a class="headerlink" href="#structured-log-format-m1" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;timestamp&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2025-10-14T10:30:00.123Z&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;level&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;INFO&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;logger&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;secflow.workflow.executor&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;message&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Node execution completed&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;trace_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;abc123def456&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;span_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;span789&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;workflow_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;workflow-123&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;node_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;scan.nuclei&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;plugin_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;nuclei-stub&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;duration_ms&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1250</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;findings_count&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">45</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;success&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;metadata&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;project_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;project-456&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;user_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;user-789&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;execution_context&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;production&quot;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="logging-configuration-m1">Logging Configuration (M1)<a class="headerlink" href="#logging-configuration-m1" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># app/logging_conf.py</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>

<span class="k">class</span><span class="w"> </span><span class="nc">StructuredFormatter</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">Formatter</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Structured JSON formatter for M1.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">):</span>
        <span class="n">log_entry</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;Z&quot;</span><span class="p">,</span>
            <span class="s2">&quot;level&quot;</span><span class="p">:</span> <span class="n">record</span><span class="o">.</span><span class="n">levelname</span><span class="p">,</span>
            <span class="s2">&quot;logger&quot;</span><span class="p">:</span> <span class="n">record</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="n">record</span><span class="o">.</span><span class="n">getMessage</span><span class="p">(),</span>
            <span class="s2">&quot;trace_id&quot;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">record</span><span class="p">,</span> <span class="s1">&#39;trace_id&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="s2">&quot;span_id&quot;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">record</span><span class="p">,</span> <span class="s1">&#39;span_id&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="s2">&quot;workflow_id&quot;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">record</span><span class="p">,</span> <span class="s1">&#39;workflow_id&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="s2">&quot;node_id&quot;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">record</span><span class="p">,</span> <span class="s1">&#39;node_id&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="s2">&quot;plugin_name&quot;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">record</span><span class="p">,</span> <span class="s1">&#39;plugin_name&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="s2">&quot;duration_ms&quot;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">record</span><span class="p">,</span> <span class="s1">&#39;duration_ms&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="s2">&quot;findings_count&quot;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">record</span><span class="p">,</span> <span class="s1">&#39;findings_count&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">record</span><span class="p">,</span> <span class="s1">&#39;success&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="s2">&quot;metadata&quot;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">record</span><span class="p">,</span> <span class="s1">&#39;metadata&#39;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">log_entry</span><span class="p">)</span>

<span class="c1"># Configure logging</span>
<span class="k">def</span><span class="w"> </span><span class="nf">setup_logging</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Setup structured logging for M1.&quot;&quot;&quot;</span>
    <span class="n">handler</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">StreamHandler</span><span class="p">()</span>
    <span class="n">handler</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">StructuredFormatter</span><span class="p">())</span>

    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;secflow&#39;</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">logger</span>
</code></pre></div>
<h3 id="workflow-execution-logging">Workflow Execution Logging<a class="headerlink" href="#workflow-execution-logging" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># packages/workflow_engine/executor.py</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">contextlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">contextmanager</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;secflow.workflow.executor&#39;</span><span class="p">)</span>

<span class="nd">@contextmanager</span>
<span class="k">def</span><span class="w"> </span><span class="nf">log_workflow_execution</span><span class="p">(</span><span class="n">workflow_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">node_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">plugin_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Context manager for workflow execution logging.&quot;&quot;&quot;</span>
    <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

    <span class="c1"># Log start</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
        <span class="s2">&quot;Node execution started&quot;</span><span class="p">,</span>
        <span class="n">extra</span><span class="o">=</span><span class="p">{</span>
            <span class="s1">&#39;workflow_id&#39;</span><span class="p">:</span> <span class="n">workflow_id</span><span class="p">,</span>
            <span class="s1">&#39;node_id&#39;</span><span class="p">:</span> <span class="n">node_id</span><span class="p">,</span>
            <span class="s1">&#39;plugin_name&#39;</span><span class="p">:</span> <span class="n">plugin_name</span><span class="p">,</span>
            <span class="s1">&#39;trace_id&#39;</span><span class="p">:</span> <span class="n">generate_trace_id</span><span class="p">(),</span>
            <span class="s1">&#39;span_id&#39;</span><span class="p">:</span> <span class="n">generate_span_id</span><span class="p">()</span>
        <span class="p">}</span>
    <span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">yield</span>
        <span class="n">success</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Node execution failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">extra</span><span class="o">=</span><span class="p">{</span>
                <span class="s1">&#39;workflow_id&#39;</span><span class="p">:</span> <span class="n">workflow_id</span><span class="p">,</span>
                <span class="s1">&#39;node_id&#39;</span><span class="p">:</span> <span class="n">node_id</span><span class="p">,</span>
                <span class="s1">&#39;plugin_name&#39;</span><span class="p">:</span> <span class="n">plugin_name</span><span class="p">,</span>
                <span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span>
                <span class="s1">&#39;success&#39;</span><span class="p">:</span> <span class="kc">False</span>
            <span class="p">}</span>
        <span class="p">)</span>
        <span class="k">raise</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="c1"># Log completion</span>
        <span class="n">duration_ms</span> <span class="o">=</span> <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s2">&quot;Node execution completed&quot;</span><span class="p">,</span>
            <span class="n">extra</span><span class="o">=</span><span class="p">{</span>
                <span class="s1">&#39;workflow_id&#39;</span><span class="p">:</span> <span class="n">workflow_id</span><span class="p">,</span>
                <span class="s1">&#39;node_id&#39;</span><span class="p">:</span> <span class="n">node_id</span><span class="p">,</span>
                <span class="s1">&#39;plugin_name&#39;</span><span class="p">:</span> <span class="n">plugin_name</span><span class="p">,</span>
                <span class="s1">&#39;duration_ms&#39;</span><span class="p">:</span> <span class="n">duration_ms</span><span class="p">,</span>
                <span class="s1">&#39;success&#39;</span><span class="p">:</span> <span class="n">success</span>
            <span class="p">}</span>
        <span class="p">)</span>
</code></pre></div>
<hr />
<h2 id="metrics-subsystem-m1">📊 Metrics Subsystem (M1)<a class="headerlink" href="#metrics-subsystem-m1" title="Permanent link">&para;</a></h2>
<h3 id="in-memory-metrics-collection">In-Memory Metrics Collection<a class="headerlink" href="#in-memory-metrics-collection" title="Permanent link">&para;</a></h3>
<p><strong>M1 Implementation</strong>: Metrics collected in-memory and stored via StoragePort.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># analytics_core/metrics_telemetry.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">List</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dataclasses</span><span class="w"> </span><span class="kn">import</span> <span class="n">dataclass</span><span class="p">,</span> <span class="n">field</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">threading</span>

<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">MetricPoint</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Individual metric data point.&quot;&quot;&quot;</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">value</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">labels</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>
    <span class="n">timestamp</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;Z&quot;</span><span class="p">)</span>

<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">MetricsSnapshot</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Snapshot of metrics at a point in time.&quot;&quot;&quot;</span>
    <span class="n">timestamp</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">metrics</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">MetricPoint</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>

<span class="k">class</span><span class="w"> </span><span class="nc">InMemoryMetricsCollector</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;In-memory metrics collector for M1.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_metrics</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">MetricPoint</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">record_counter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">labels</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Record a counter metric.&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_metrics</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">MetricPoint</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
                <span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">,</span>
                <span class="n">labels</span><span class="o">=</span><span class="n">labels</span> <span class="ow">or</span> <span class="p">{}</span>
            <span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">record_gauge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">labels</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Record a gauge metric.&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_metrics</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">MetricPoint</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
                <span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">,</span>
                <span class="n">labels</span><span class="o">=</span><span class="n">labels</span> <span class="ow">or</span> <span class="p">{}</span>
            <span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">record_histogram</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">labels</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Record a histogram metric.&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_metrics</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">MetricPoint</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
                <span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">,</span>
                <span class="n">labels</span><span class="o">=</span><span class="n">labels</span> <span class="ow">or</span> <span class="p">{}</span>
            <span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_metrics_snapshot</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MetricsSnapshot</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get current metrics snapshot.&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">MetricsSnapshot</span><span class="p">(</span>
                <span class="n">timestamp</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;Z&quot;</span><span class="p">,</span>
                <span class="n">metrics</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_metrics</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">clear_metrics</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Clear collected metrics.&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_metrics</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</code></pre></div>
<h3 id="workflow-metrics">Workflow Metrics<a class="headerlink" href="#workflow-metrics" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># packages/workflow_engine/metrics.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">analytics_core.metrics_telemetry</span><span class="w"> </span><span class="kn">import</span> <span class="n">InMemoryMetricsCollector</span>

<span class="k">class</span><span class="w"> </span><span class="nc">WorkflowMetrics</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Workflow-specific metrics for M1.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">collector</span><span class="p">:</span> <span class="n">InMemoryMetricsCollector</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collector</span> <span class="o">=</span> <span class="n">collector</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">record_workflow_start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">workflow_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">workflow_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Record workflow start metric.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collector</span><span class="o">.</span><span class="n">record_counter</span><span class="p">(</span>
            <span class="s2">&quot;secflow_workflows_started_total&quot;</span><span class="p">,</span>
            <span class="n">labels</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;workflow_id&quot;</span><span class="p">:</span> <span class="n">workflow_id</span><span class="p">,</span>
                <span class="s2">&quot;workflow_name&quot;</span><span class="p">:</span> <span class="n">workflow_name</span>
            <span class="p">}</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">record_workflow_completion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">workflow_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">workflow_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
                                  <span class="n">duration_ms</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">success</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Record workflow completion metric.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collector</span><span class="o">.</span><span class="n">record_counter</span><span class="p">(</span>
            <span class="s2">&quot;secflow_workflows_completed_total&quot;</span><span class="p">,</span>
            <span class="n">labels</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;workflow_id&quot;</span><span class="p">:</span> <span class="n">workflow_id</span><span class="p">,</span>
                <span class="s2">&quot;workflow_name&quot;</span><span class="p">:</span> <span class="n">workflow_name</span><span class="p">,</span>
                <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;success&quot;</span> <span class="k">if</span> <span class="n">success</span> <span class="k">else</span> <span class="s2">&quot;failure&quot;</span>
            <span class="p">}</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">collector</span><span class="o">.</span><span class="n">record_histogram</span><span class="p">(</span>
            <span class="s2">&quot;secflow_workflow_duration_ms&quot;</span><span class="p">,</span>
            <span class="n">duration_ms</span><span class="p">,</span>
            <span class="n">labels</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;workflow_id&quot;</span><span class="p">:</span> <span class="n">workflow_id</span><span class="p">,</span>
                <span class="s2">&quot;workflow_name&quot;</span><span class="p">:</span> <span class="n">workflow_name</span>
            <span class="p">}</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">record_node_execution</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">plugin_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
                             <span class="n">duration_ms</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">findings_count</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Record node execution metric.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collector</span><span class="o">.</span><span class="n">record_counter</span><span class="p">(</span>
            <span class="s2">&quot;secflow_nodes_executed_total&quot;</span><span class="p">,</span>
            <span class="n">labels</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;node_id&quot;</span><span class="p">:</span> <span class="n">node_id</span><span class="p">,</span>
                <span class="s2">&quot;plugin_name&quot;</span><span class="p">:</span> <span class="n">plugin_name</span>
            <span class="p">}</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">collector</span><span class="o">.</span><span class="n">record_histogram</span><span class="p">(</span>
            <span class="s2">&quot;secflow_node_duration_ms&quot;</span><span class="p">,</span>
            <span class="n">duration_ms</span><span class="p">,</span>
            <span class="n">labels</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;node_id&quot;</span><span class="p">:</span> <span class="n">node_id</span><span class="p">,</span>
                <span class="s2">&quot;plugin_name&quot;</span><span class="p">:</span> <span class="n">plugin_name</span>
            <span class="p">}</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">collector</span><span class="o">.</span><span class="n">record_gauge</span><span class="p">(</span>
            <span class="s2">&quot;secflow_findings_generated_total&quot;</span><span class="p">,</span>
            <span class="n">findings_count</span><span class="p">,</span>
            <span class="n">labels</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;node_id&quot;</span><span class="p">:</span> <span class="n">node_id</span><span class="p">,</span>
                <span class="s2">&quot;plugin_name&quot;</span><span class="p">:</span> <span class="n">plugin_name</span>
            <span class="p">}</span>
        <span class="p">)</span>
</code></pre></div>
<h3 id="plugin-metrics">Plugin Metrics<a class="headerlink" href="#plugin-metrics" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># packages/plugins/metrics.py</span>
<span class="k">class</span><span class="w"> </span><span class="nc">PluginMetrics</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Plugin-specific metrics for M1.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">collector</span><span class="p">:</span> <span class="n">InMemoryMetricsCollector</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collector</span> <span class="o">=</span> <span class="n">collector</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">record_plugin_load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plugin_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">success</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Record plugin loading metric.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collector</span><span class="o">.</span><span class="n">record_counter</span><span class="p">(</span>
            <span class="s2">&quot;secflow_plugins_loaded_total&quot;</span><span class="p">,</span>
            <span class="n">labels</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;plugin_name&quot;</span><span class="p">:</span> <span class="n">plugin_name</span><span class="p">,</span>
                <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;success&quot;</span> <span class="k">if</span> <span class="n">success</span> <span class="k">else</span> <span class="s2">&quot;failure&quot;</span>
            <span class="p">}</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">record_plugin_execution</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plugin_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">duration_ms</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> 
                               <span class="n">memory_mb</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">success</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Record plugin execution metric.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collector</span><span class="o">.</span><span class="n">record_counter</span><span class="p">(</span>
            <span class="s2">&quot;secflow_plugin_executions_total&quot;</span><span class="p">,</span>
            <span class="n">labels</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;plugin_name&quot;</span><span class="p">:</span> <span class="n">plugin_name</span><span class="p">,</span>
                <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;success&quot;</span> <span class="k">if</span> <span class="n">success</span> <span class="k">else</span> <span class="s2">&quot;failure&quot;</span>
            <span class="p">}</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">collector</span><span class="o">.</span><span class="n">record_histogram</span><span class="p">(</span>
            <span class="s2">&quot;secflow_plugin_duration_ms&quot;</span><span class="p">,</span>
            <span class="n">duration_ms</span><span class="p">,</span>
            <span class="n">labels</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;plugin_name&quot;</span><span class="p">:</span> <span class="n">plugin_name</span><span class="p">}</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">collector</span><span class="o">.</span><span class="n">record_gauge</span><span class="p">(</span>
            <span class="s2">&quot;secflow_plugin_memory_mb&quot;</span><span class="p">,</span>
            <span class="n">memory_mb</span><span class="p">,</span>
            <span class="n">labels</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;plugin_name&quot;</span><span class="p">:</span> <span class="n">plugin_name</span><span class="p">}</span>
        <span class="p">)</span>
</code></pre></div>
<hr />
<h2 id="debugging-troubleshooting-m1">🔍 Debugging &amp; Troubleshooting (M1)<a class="headerlink" href="#debugging-troubleshooting-m1" title="Permanent link">&para;</a></h2>
<h3 id="debug-mode">Debug Mode<a class="headerlink" href="#debug-mode" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Enable debug logging</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">SECFLOW_LOG_LEVEL</span><span class="o">=</span><span class="s2">&quot;DEBUG&quot;</span>
python<span class="w"> </span>tools/run_workflow.py<span class="w"> </span>workflows/sample-linear.yaml<span class="w"> </span>--execute<span class="w"> </span>--verbose

<span class="c1"># Debug plugin loading</span>
python<span class="w"> </span>tools/validate_recipe.py<span class="w"> </span>workflows/sample-linear.yaml<span class="w"> </span>--debug

<span class="c1"># Debug storage operations</span>
python<span class="w"> </span>tools/test_storage.py<span class="w"> </span>--adapter<span class="w"> </span>memory<span class="w"> </span>--debug
</code></pre></div>
<h3 id="debug-configuration">Debug Configuration<a class="headerlink" href="#debug-configuration" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># app/logging_conf.py</span>
<span class="k">def</span><span class="w"> </span><span class="nf">setup_debug_logging</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Setup debug logging for troubleshooting.&quot;&quot;&quot;</span>
    <span class="n">handler</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">StreamHandler</span><span class="p">()</span>
    <span class="n">handler</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">StructuredFormatter</span><span class="p">())</span>

    <span class="c1"># Enable debug for all SecFlow loggers</span>
    <span class="k">for</span> <span class="n">logger_name</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;secflow&#39;</span><span class="p">,</span> <span class="s1">&#39;packages&#39;</span><span class="p">,</span> <span class="s1">&#39;tools&#39;</span><span class="p">]:</span>
        <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">logger_name</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">logger</span>
</code></pre></div>
<h3 id="common-debug-scenarios">Common Debug Scenarios<a class="headerlink" href="#common-debug-scenarios" title="Permanent link">&para;</a></h3>
<h4 id="1-plugin-loading-issues">1. Plugin Loading Issues<a class="headerlink" href="#1-plugin-loading-issues" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="c1"># Debug plugin loading</span>
<span class="k">def</span><span class="w"> </span><span class="nf">debug_plugin_loading</span><span class="p">(</span><span class="n">plugin_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Debug plugin loading issues.&quot;&quot;&quot;</span>
    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;secflow.plugins.loader&#39;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Attempting to load plugin: </span><span class="si">{</span><span class="n">plugin_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">plugin</span> <span class="o">=</span> <span class="n">plugin_loader</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">plugin_name</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Plugin loaded successfully: </span><span class="si">{</span><span class="n">plugin</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">plugin</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Plugin loading failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Plugin path: </span><span class="si">{</span><span class="n">plugin_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Manifest: </span><span class="si">{</span><span class="n">manifest</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span>
</code></pre></div>
<h4 id="2-workflow-execution-issues">2. Workflow Execution Issues<a class="headerlink" href="#2-workflow-execution-issues" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="c1"># Debug workflow execution</span>
<span class="k">def</span><span class="w"> </span><span class="nf">debug_workflow_execution</span><span class="p">(</span><span class="n">workflow_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Debug workflow execution issues.&quot;&quot;&quot;</span>
    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;secflow.workflow.executor&#39;</span><span class="p">)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Starting workflow execution: </span><span class="si">{</span><span class="n">workflow_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">workflow</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Executing node: </span><span class="si">{</span><span class="n">node</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">node</span><span class="o">.</span><span class="n">type</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">execute_node</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Node completed: </span><span class="si">{</span><span class="n">node</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Node failed: </span><span class="si">{</span><span class="n">node</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Node config: </span><span class="si">{</span><span class="n">node</span><span class="o">.</span><span class="n">config</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Node inputs: </span><span class="si">{</span><span class="n">node</span><span class="o">.</span><span class="n">inputs</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span>
</code></pre></div>
<h4 id="3-storage-issues">3. Storage Issues<a class="headerlink" href="#3-storage-issues" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="c1"># Debug storage operations</span>
<span class="k">def</span><span class="w"> </span><span class="nf">debug_storage_operations</span><span class="p">(</span><span class="n">storage</span><span class="p">:</span> <span class="n">StoragePort</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Debug storage operation issues.&quot;&quot;&quot;</span>
    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;secflow.storage&#39;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Test basic operations</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Testing storage operations&quot;</span><span class="p">)</span>

        <span class="c1"># Test finding save</span>
        <span class="n">test_finding</span> <span class="o">=</span> <span class="n">create_test_finding</span><span class="p">()</span>
        <span class="n">storage</span><span class="o">.</span><span class="n">save_finding</span><span class="p">(</span><span class="n">test_finding</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Finding saved successfully&quot;</span><span class="p">)</span>

        <span class="c1"># Test finding list</span>
        <span class="n">findings</span> <span class="o">=</span> <span class="n">storage</span><span class="o">.</span><span class="n">list_findings</span><span class="p">(</span><span class="n">test_finding</span><span class="p">[</span><span class="s2">&quot;project_id&quot;</span><span class="p">])</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">findings</span><span class="p">)</span><span class="si">}</span><span class="s2"> findings&quot;</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Storage operation failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Storage type: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">storage</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span>
</code></pre></div>
<hr />
<h2 id="performance-monitoring-m1">📈 Performance Monitoring (M1)<a class="headerlink" href="#performance-monitoring-m1" title="Permanent link">&para;</a></h2>
<h3 id="performance-metrics">Performance Metrics<a class="headerlink" href="#performance-metrics" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># analytics_core/performance_monitor.py</span>
<span class="k">class</span><span class="w"> </span><span class="nc">PerformanceMonitor</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Performance monitoring for M1.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">collector</span><span class="p">:</span> <span class="n">InMemoryMetricsCollector</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collector</span> <span class="o">=</span> <span class="n">collector</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">record_system_metrics</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Record system performance metrics.&quot;&quot;&quot;</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">psutil</span>

        <span class="c1"># CPU usage</span>
        <span class="n">cpu_percent</span> <span class="o">=</span> <span class="n">psutil</span><span class="o">.</span><span class="n">cpu_percent</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collector</span><span class="o">.</span><span class="n">record_gauge</span><span class="p">(</span><span class="s2">&quot;secflow_system_cpu_percent&quot;</span><span class="p">,</span> <span class="n">cpu_percent</span><span class="p">)</span>

        <span class="c1"># Memory usage</span>
        <span class="n">memory</span> <span class="o">=</span> <span class="n">psutil</span><span class="o">.</span><span class="n">virtual_memory</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collector</span><span class="o">.</span><span class="n">record_gauge</span><span class="p">(</span><span class="s2">&quot;secflow_system_memory_percent&quot;</span><span class="p">,</span> <span class="n">memory</span><span class="o">.</span><span class="n">percent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collector</span><span class="o">.</span><span class="n">record_gauge</span><span class="p">(</span><span class="s2">&quot;secflow_system_memory_mb&quot;</span><span class="p">,</span> <span class="n">memory</span><span class="o">.</span><span class="n">used</span> <span class="o">/</span> <span class="mi">1024</span> <span class="o">/</span> <span class="mi">1024</span><span class="p">)</span>

        <span class="c1"># Disk usage</span>
        <span class="n">disk</span> <span class="o">=</span> <span class="n">psutil</span><span class="o">.</span><span class="n">disk_usage</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collector</span><span class="o">.</span><span class="n">record_gauge</span><span class="p">(</span><span class="s2">&quot;secflow_system_disk_percent&quot;</span><span class="p">,</span> <span class="n">disk</span><span class="o">.</span><span class="n">percent</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">record_workflow_performance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">workflow_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
                                   <span class="n">total_duration_ms</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
                                   <span class="n">node_count</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                                   <span class="n">findings_count</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Record workflow performance metrics.&quot;&quot;&quot;</span>
        <span class="c1"># Throughput metrics</span>
        <span class="n">findings_per_second</span> <span class="o">=</span> <span class="n">findings_count</span> <span class="o">/</span> <span class="p">(</span><span class="n">total_duration_ms</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">)</span> <span class="k">if</span> <span class="n">total_duration_ms</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collector</span><span class="o">.</span><span class="n">record_gauge</span><span class="p">(</span>
            <span class="s2">&quot;secflow_workflow_findings_per_second&quot;</span><span class="p">,</span>
            <span class="n">findings_per_second</span><span class="p">,</span>
            <span class="n">labels</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;workflow_id&quot;</span><span class="p">:</span> <span class="n">workflow_id</span><span class="p">}</span>
        <span class="p">)</span>

        <span class="c1"># Efficiency metrics</span>
        <span class="n">avg_node_duration</span> <span class="o">=</span> <span class="n">total_duration_ms</span> <span class="o">/</span> <span class="n">node_count</span> <span class="k">if</span> <span class="n">node_count</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collector</span><span class="o">.</span><span class="n">record_gauge</span><span class="p">(</span>
            <span class="s2">&quot;secflow_workflow_avg_node_duration_ms&quot;</span><span class="p">,</span>
            <span class="n">avg_node_duration</span><span class="p">,</span>
            <span class="n">labels</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;workflow_id&quot;</span><span class="p">:</span> <span class="n">workflow_id</span><span class="p">}</span>
        <span class="p">)</span>
</code></pre></div>
<h3 id="performance-analysis">Performance Analysis<a class="headerlink" href="#performance-analysis" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># tools/performance_analysis.py</span>
<span class="k">def</span><span class="w"> </span><span class="nf">analyze_workflow_performance</span><span class="p">(</span><span class="n">workflow_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Analyze workflow performance metrics.&quot;&quot;&quot;</span>
    <span class="n">metrics</span> <span class="o">=</span> <span class="n">get_metrics_snapshot</span><span class="p">()</span>

    <span class="n">workflow_metrics</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">m</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">metrics</span><span class="o">.</span><span class="n">metrics</span> 
        <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;workflow_id&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="n">workflow_id</span>
    <span class="p">]</span>

    <span class="n">analysis</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;workflow_id&quot;</span><span class="p">:</span> <span class="n">workflow_id</span><span class="p">,</span>
        <span class="s2">&quot;total_duration_ms&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">&quot;node_count&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">&quot;findings_count&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">&quot;avg_node_duration_ms&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">&quot;findings_per_second&quot;</span><span class="p">:</span> <span class="mi">0</span>
    <span class="p">}</span>

    <span class="c1"># Calculate metrics</span>
    <span class="k">for</span> <span class="n">metric</span> <span class="ow">in</span> <span class="n">workflow_metrics</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">metric</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;secflow_workflow_duration_ms&quot;</span><span class="p">:</span>
            <span class="n">analysis</span><span class="p">[</span><span class="s2">&quot;total_duration_ms&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">metric</span><span class="o">.</span><span class="n">value</span>
        <span class="k">elif</span> <span class="n">metric</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;secflow_nodes_executed_total&quot;</span><span class="p">:</span>
            <span class="n">analysis</span><span class="p">[</span><span class="s2">&quot;node_count&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">metric</span><span class="o">.</span><span class="n">value</span>
        <span class="k">elif</span> <span class="n">metric</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;secflow_findings_generated_total&quot;</span><span class="p">:</span>
            <span class="n">analysis</span><span class="p">[</span><span class="s2">&quot;findings_count&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">metric</span><span class="o">.</span><span class="n">value</span>

    <span class="c1"># Calculate derived metrics</span>
    <span class="k">if</span> <span class="n">analysis</span><span class="p">[</span><span class="s2">&quot;node_count&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">analysis</span><span class="p">[</span><span class="s2">&quot;avg_node_duration_ms&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">analysis</span><span class="p">[</span><span class="s2">&quot;total_duration_ms&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">analysis</span><span class="p">[</span><span class="s2">&quot;node_count&quot;</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">analysis</span><span class="p">[</span><span class="s2">&quot;total_duration_ms&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">analysis</span><span class="p">[</span><span class="s2">&quot;findings_per_second&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">analysis</span><span class="p">[</span><span class="s2">&quot;findings_count&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">analysis</span><span class="p">[</span><span class="s2">&quot;total_duration_ms&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">analysis</span>
</code></pre></div>
<hr />
<h2 id="future-enhancements-m5">🔮 Future Enhancements (M5+)<a class="headerlink" href="#future-enhancements-m5" title="Permanent link">&para;</a></h2>
<h3 id="prometheus-integration-m5">Prometheus Integration (M5)<a class="headerlink" href="#prometheus-integration-m5" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># M5: Prometheus metrics export (planned)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">prometheus_client</span><span class="w"> </span><span class="kn">import</span> <span class="n">Counter</span><span class="p">,</span> <span class="n">Histogram</span><span class="p">,</span> <span class="n">Gauge</span><span class="p">,</span> <span class="n">start_http_server</span>

<span class="c1"># Prometheus metrics</span>
<span class="n">workflow_counter</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="s1">&#39;secflow_workflows_total&#39;</span><span class="p">,</span> <span class="s1">&#39;Total workflows executed&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">])</span>
<span class="n">workflow_duration</span> <span class="o">=</span> <span class="n">Histogram</span><span class="p">(</span><span class="s1">&#39;secflow_workflow_duration_seconds&#39;</span><span class="p">,</span> <span class="s1">&#39;Workflow execution duration&#39;</span><span class="p">)</span>
<span class="n">node_duration</span> <span class="o">=</span> <span class="n">Histogram</span><span class="p">(</span><span class="s1">&#39;secflow_node_duration_seconds&#39;</span><span class="p">,</span> <span class="s1">&#39;Node execution duration&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;node_type&#39;</span><span class="p">])</span>
<span class="n">findings_gauge</span> <span class="o">=</span> <span class="n">Gauge</span><span class="p">(</span><span class="s1">&#39;secflow_findings_total&#39;</span><span class="p">,</span> <span class="s1">&#39;Total findings generated&#39;</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">start_prometheus_server</span><span class="p">(</span><span class="n">port</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">8000</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Start Prometheus metrics server.&quot;&quot;&quot;</span>
    <span class="n">start_http_server</span><span class="p">(</span><span class="n">port</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Prometheus metrics server started on port </span><span class="si">{</span><span class="n">port</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<h3 id="opentelemetry-integration-m5">OpenTelemetry Integration (M5)<a class="headerlink" href="#opentelemetry-integration-m5" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># M5: OpenTelemetry tracing (planned)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">opentelemetry</span><span class="w"> </span><span class="kn">import</span> <span class="n">trace</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">opentelemetry.exporter.otlp.proto.grpc.trace_exporter</span><span class="w"> </span><span class="kn">import</span> <span class="n">OTLPSpanExporter</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">opentelemetry.sdk.trace</span><span class="w"> </span><span class="kn">import</span> <span class="n">TracerProvider</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">opentelemetry.sdk.trace.export</span><span class="w"> </span><span class="kn">import</span> <span class="n">BatchSpanProcessor</span>

<span class="k">def</span><span class="w"> </span><span class="nf">setup_tracing</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Setup OpenTelemetry tracing.&quot;&quot;&quot;</span>
    <span class="n">trace</span><span class="o">.</span><span class="n">set_tracer_provider</span><span class="p">(</span><span class="n">TracerProvider</span><span class="p">())</span>
    <span class="n">tracer</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">get_tracer</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="n">otlp_exporter</span> <span class="o">=</span> <span class="n">OTLPSpanExporter</span><span class="p">(</span><span class="n">endpoint</span><span class="o">=</span><span class="s2">&quot;http://localhost:4317&quot;</span><span class="p">)</span>
    <span class="n">span_processor</span> <span class="o">=</span> <span class="n">BatchSpanProcessor</span><span class="p">(</span><span class="n">otlp_exporter</span><span class="p">)</span>
    <span class="n">trace</span><span class="o">.</span><span class="n">get_tracer_provider</span><span class="p">()</span><span class="o">.</span><span class="n">add_span_processor</span><span class="p">(</span><span class="n">span_processor</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">tracer</span>
</code></pre></div>
<h3 id="grafana-dashboards-m5">Grafana Dashboards (M5)<a class="headerlink" href="#grafana-dashboards-m5" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># M5: Grafana dashboard configuration (planned)</span>
<span class="nt">dashboard</span><span class="p">:</span>
<span class="w">  </span><span class="nt">title</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;SecFlow</span><span class="nv"> </span><span class="s">Observability</span><span class="nv"> </span><span class="s">Dashboard&quot;</span>
<span class="w">  </span><span class="nt">panels</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">title</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Workflow</span><span class="nv"> </span><span class="s">Execution</span><span class="nv"> </span><span class="s">Rate&quot;</span>
<span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;graph&quot;</span>
<span class="w">      </span><span class="nt">targets</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">expr</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;rate(secflow_workflows_total[5m])&quot;</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">title</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Average</span><span class="nv"> </span><span class="s">Workflow</span><span class="nv"> </span><span class="s">Duration&quot;</span>
<span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;graph&quot;</span>
<span class="w">      </span><span class="nt">targets</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">expr</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;histogram_quantile(0.95,</span><span class="nv"> </span><span class="s">secflow_workflow_duration_seconds)&quot;</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">title</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Findings</span><span class="nv"> </span><span class="s">Generated&quot;</span>
<span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;graph&quot;</span>
<span class="w">      </span><span class="nt">targets</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">expr</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;secflow_findings_total&quot;</span>
</code></pre></div>
<hr />
<h2 id="observability-best-practices">📚 Observability Best Practices<a class="headerlink" href="#observability-best-practices" title="Permanent link">&para;</a></h2>
<h3 id="for-developers">For Developers<a class="headerlink" href="#for-developers" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>Use Structured Logging</strong>: Always use JSON format with correlation IDs</li>
<li><strong>Include Context</strong>: Add relevant metadata to log entries</li>
<li><strong>Record Metrics</strong>: Instrument key operations with metrics</li>
<li><strong>Handle Errors Gracefully</strong>: Log errors with sufficient context</li>
<li><strong>Use Debug Mode</strong>: Enable debug logging for troubleshooting</li>
</ol>
<h3 id="for-operators">For Operators<a class="headerlink" href="#for-operators" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>Monitor Key Metrics</strong>: Track workflow execution rates and durations</li>
<li><strong>Set Up Alerts</strong>: Configure alerts for critical failures</li>
<li><strong>Regular Log Review</strong>: Periodically review logs for issues</li>
<li><strong>Performance Analysis</strong>: Analyze performance trends over time</li>
<li><strong>Capacity Planning</strong>: Use metrics for capacity planning</li>
</ol>
<h3 id="for-security-teams">For Security Teams<a class="headerlink" href="#for-security-teams" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>Audit Log Review</strong>: Regularly review security audit logs</li>
<li><strong>Anomaly Detection</strong>: Monitor for unusual patterns</li>
<li><strong>Compliance Monitoring</strong>: Ensure logging meets compliance requirements</li>
<li><strong>Incident Response</strong>: Use logs for security incident investigation</li>
<li><strong>Access Monitoring</strong>: Track user access and actions</li>
</ol>
<hr />
<p><strong>Next:</strong> <a href="../18-error-handling-and-recovery/">Error Handling &amp; Recovery</a></p>
<p>SecFlow uses OpenTelemetry (OTel) for distributed tracing.
Every API request, task dispatch, and plugin call generates spans linked under one root trace.</p>
<h3 id="example-trace-structure">Example Trace Structure<a class="headerlink" href="#example-trace-structure" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>TraceID: 5b2e4f21c9a344f9
</code></pre></div>
<div class="mermaid">%%{init: {"theme":"neutral"}}%%
flowchart TD
    A["api.request (GET /api/v1/workflows)"]
    B["worker.dispatch"]
    C["tool.nuclei.run"]
    D["sandbox.spawn"]
    E["sandbox.cleanup"]
    F["tool.ferox.run"]
    G["findings.persist"]
    H["api.response"]

    A --&gt; B
    A --&gt; H
    B --&gt; C
    B --&gt; F
    B --&gt; G
    C --&gt; D
    C --&gt; E</div>
<h3 id="code-example">Code Example<a class="headerlink" href="#code-example" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>from opentelemetry import trace

tracer = trace.get_tracer(&quot;SecFlow.worker&quot;)

with tracer.start_as_current_span(&quot;workflow.execute&quot;) as span:
    span.set_attribute(&quot;workflow.id&quot;, workflow.id)
    run_workflow(workflow)
</code></pre></div>
<p>All traces are exported through OTLP gRPC to the observability backend (e.g., Tempo, Jaeger).</p>
<h2 id="metrics-system">📊 Metrics System<a class="headerlink" href="#metrics-system" title="Permanent link">&para;</a></h2>
<p>SecFlow exposes runtime metrics through Prometheus-compatible endpoints.</p>
<h3 id="default-endpoint">Default Endpoint<a class="headerlink" href="#default-endpoint" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>/metrics
</code></pre></div>
<h3 id="example-metrics">Example Metrics<a class="headerlink" href="#example-metrics" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Metric</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>secflow_requests_total</td>
<td>Counter</td>
<td>Total API requests handled</td>
</tr>
<tr>
<td>secflow_active_workflows</td>
<td>Gauge</td>
<td>Currently running workflows</td>
</tr>
<tr>
<td>secflow_findings_generated_total</td>
<td>Counter</td>
<td>Findings created</td>
</tr>
<tr>
<td>secflow_task_duration_seconds</td>
<td>Histogram</td>
<td>Time taken by async tasks</td>
</tr>
<tr>
<td>secflow_gc_bytes_reclaimed_total</td>
<td>Counter</td>
<td>GC reclaimed bytes</td>
</tr>
<tr>
<td>secflow_sandbox_executions_total</td>
<td>Counter</td>
<td>Number of sandbox runs</td>
</tr>
<tr>
<td>secflow_tool_failures_total</td>
<td>Counter</td>
<td>Failed tool executions</td>
</tr>
<tr>
<td>secflow_worker_queue_depth</td>
<td>Gauge</td>
<td>Pending Celery tasks</td>
</tr>
<tr>
<td>secflow_cve_enrichment_latency_seconds</td>
<td>Histogram</td>
<td>Time per CVE query</td>
</tr>
</tbody>
</table>
<h3 id="prometheus-export-example">Prometheus Export Example<a class="headerlink" href="#prometheus-export-example" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>from prometheus_client import Counter, Gauge

findings_total = Counter(&quot;secflow_findings_generated_total&quot;, &quot;Number of findings created&quot;)
active_workflows = Gauge(&quot;secflow_active_workflows&quot;, &quot;Currently running workflows&quot;)
</code></pre></div>
<h2 id="example-grafana-dashboard-panels">🔍 Example Grafana Dashboard Panels<a class="headerlink" href="#example-grafana-dashboard-panels" title="Permanent link">&para;</a></h2>
<table>
<thead>
<tr>
<th>Panel</th>
<th>Visualization</th>
<th>Query</th>
</tr>
</thead>
<tbody>
<tr>
<td>Workflow Throughput</td>
<td>Time series</td>
<td><code>rate(secflow_requests_total[5m])</code></td>
</tr>
<tr>
<td>Average Scan Duration</td>
<td>Histogram</td>
<td><code>histogram_quantile(0.9, rate(secflow_task_duration_seconds_bucket[5m]))</code></td>
</tr>
<tr>
<td>Findings per Project</td>
<td>Bar chart</td>
<td><code>sum by (project)(secflow_findings_generated_total)</code></td>
</tr>
<tr>
<td>GC Efficiency</td>
<td>SingleStat</td>
<td><code>rate(secflow_gc_bytes_reclaimed_total[1h])</code></td>
</tr>
<tr>
<td>Sandbox Failures</td>
<td>Table</td>
<td><code>secflow_tool_failures_total</code></td>
</tr>
</tbody>
</table>
<h2 id="error-correlation-incident-debugging">🧩 Error Correlation &amp; Incident Debugging<a class="headerlink" href="#error-correlation-incident-debugging" title="Permanent link">&para;</a></h2>
<p>Every finding, workflow, and audit entry includes a trace ID.
Errors can be traced back to exact processes and spans.</p>
<h3 id="example-correlation">Example correlation:<a class="headerlink" href="#example-correlation" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>Finding → Workflow ID: wf-abc123 → Trace ID: cbd82b67a1e4f9d2c8b5e6f7a3d4c9e2b1f8a5c6d7e9f2a3b4c5d6e7f8a9b2c3d4e5f6
→ Logs: worker.log
→ Span: tool.nuclei.run
</code></pre></div>
<p>This guarantees reproducibility and fast RCA (root cause analysis).</p>
<h2 id="alerting-health-checks">🧠 Alerting &amp; Health Checks<a class="headerlink" href="#alerting-health-checks" title="Permanent link">&para;</a></h2>
<h3 id="health-endpoints">Health Endpoints<a class="headerlink" href="#health-endpoints" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Endpoint</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>/healthz</code></td>
<td>Liveness probe (basic app status)</td>
</tr>
<tr>
<td><code>/readyz</code></td>
<td>Readiness probe (DB + cache + queue connectivity)</td>
</tr>
</tbody>
</table>
<h3 id="example-output">Example Output<a class="headerlink" href="#example-output" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>{
  &quot;status&quot;: &quot;ok&quot;,
  &quot;services&quot;: {
    &quot;database&quot;: &quot;up&quot;,
    &quot;cache&quot;: &quot;up&quot;,
    &quot;worker&quot;: &quot;idle&quot;
  }
}
</code></pre></div>
<h3 id="alerts-prometheus-rules">Alerts (Prometheus Rules)<a class="headerlink" href="#alerts-prometheus-rules" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>groups:
  - name: secflow_alerts
    rules:
      - alert: HighErrorRate
        expr: rate(secflow_tool_failures_total[5m]) &gt; 5
        for: 10m
        labels: { severity: warning }
        annotations:
          summary: &quot;Tool failure rate too high&quot;
</code></pre></div>
<h2 id="security-of-observability-data">🔒 Security of Observability Data<a class="headerlink" href="#security-of-observability-data" title="Permanent link">&para;</a></h2>
<table>
<thead>
<tr>
<th>Concern</th>
<th>Mitigation</th>
</tr>
</thead>
<tbody>
<tr>
<td>Sensitive logs</td>
<td>Field redaction (password, token, secret)</td>
</tr>
<tr>
<td>Trace integrity</td>
<td>HMAC signing of exported spans</td>
</tr>
<tr>
<td>Log tampering</td>
<td>Append-only JSONL + rotation</td>
</tr>
<tr>
<td>Metrics abuse</td>
<td>Authenticated <code>/metrics</code> endpoint (basic token or mutual TLS)</td>
</tr>
</tbody>
</table>
<h3 id="example-redaction-middleware">Example redaction middleware:<a class="headerlink" href="#example-redaction-middleware" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>def sanitize(data: dict) -&gt; dict:
    for key in data.keys():
        if &quot;token&quot; in key.lower() or &quot;password&quot; in key.lower():
            data[key] = &quot;[REDACTED]&quot;
    return data
</code></pre></div>
<h2 id="correlation-example-end-to-end-trace">🧱 Correlation Example: End-to-End Trace<a class="headerlink" href="#correlation-example-end-to-end-trace" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code>[TRACE 5b2e4f21c9a344f9]
</code></pre></div>
<div class="mermaid">%%{init: {"theme":"neutral"}}%%
flowchart TD
    A["/api/v1/workflows/start"]
    B["worker.queue.dispatch (duration=12ms)"]
    C["tool.ferox.run (duration=4.1s)"]
    D["tool.nuclei.run (duration=9.3s)"]
    E["enrich.cve (duration=1.4s)"]
    F["findings.persist (duration=320ms)"]
    G["audit.log (duration=7ms)"]

    A --&gt; B
    A --&gt; C
    A --&gt; D
    A --&gt; E
    A --&gt; F
    A --&gt; G</div>
<h2 id="integration-with-cicd-and-testing">🧩 Integration with CI/CD and Testing<a class="headerlink" href="#integration-with-cicd-and-testing" title="Permanent link">&para;</a></h2>
<p>During CI runs:
- Unit and integration tests export OTel traces for regression analysis.
- Performance tests measure task durations and error rates.</p>
<h3 id="example-ci-configuration">Example CI configuration:<a class="headerlink" href="#example-ci-configuration" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>env:
  OTEL_EXPORTER_OTLP_ENDPOINT: &quot;http://otel-collector:4317&quot;
  PROMETHEUS_MULTIPROC_DIR: &quot;/tmp/metrics&quot;
</code></pre></div>
<h2 id="future-enhancements">🔮 Future Enhancements<a class="headerlink" href="#future-enhancements" title="Permanent link">&para;</a></h2>
<ul>
<li>Distributed tracing for multi-cluster deployments.</li>
<li>Real-time log streaming to the web UI.</li>
<li>AI-assisted anomaly detection for workflow performance.</li>
<li>Adaptive sampling for trace volume reduction.</li>
<li>On-demand debug mode via CLI flag (<code>--trace verbose</code>).</li>
</ul>
<hr />
<p><strong>Next:</strong> <a href="../18-error-handling-and-recovery/">Error Handling &amp; Recovery</a>
<div class="highlight"><pre><span></span><code>
</code></pre></div>
<div class="highlight"><pre><span></span><code>
</code></pre></div>
<div class="highlight"><pre><span></span><code>
</code></pre></div>
<div class="highlight"><pre><span></span><code>
</code></pre></div>
<div class="highlight"><pre><span></span><code>
</code></pre></div>
<div class="highlight"><pre><span></span><code>
</code></pre></div>
<div class="highlight"><pre><span></span><code>
</code></pre></div>
<div class="highlight"><pre><span></span><code>
</code></pre></div>
<div class="highlight"><pre><span></span><code>
</code></pre></div>
<div class="highlight"><pre><span></span><code>
</code></pre></div>
<div class="highlight"><pre><span></span><code>
</code></pre></div>
<div class="highlight"><pre><span></span><code>
</code></pre></div></p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../../js/bootstrap.bundle.min.js"></script>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js"></script>
        <script src="../../js/mermaid.min.js"></script>
        <script src="../../js/mermaid-init.js"></script>
        <script src="../../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
